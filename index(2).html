<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Formulario Bancoppel</title>
</head>
<body>
  <h1>Formulario Bancoppel</h1>
  <form id="formulario">
    <label>Nombre: <input type="text" name="nombre" /></label><br />
    <label>Celular: <input type="text" name="celular" /></label><br />
    <label>Tipificación: 
      <select name="tipificacion" id="tipificacion"></select>
    </label><br /><br />
    <button type="button" onclick="generarRegistro()">Generar Registro</button>
    <button type="button" onclick="guardarRegistro()">Guardar Registro</button>
    <button type="button" onclick="buscarRegistro()">Buscar Registro</button>
  </form>

  <script>
    const url = "https://script.google.com/macros/s/AKfycby5vwvZKULUs2ULIiGqn0higkzKfagQkHrfhASKCKjCqN28KVljQh0M45_dwZDROPsKCg/exec";

    function generarRegistro() {
      alert("Aquí deberías hacer una llamada a la hoja 'BDD'");
    }

    function guardarRegistro() {
      const form = document.getElementById("formulario");
      const datos = Object.fromEntries(new FormData(form));
      fetch(url, {
        method: "POST",
        body: JSON.stringify(datos),
        headers: { "Content-Type": "application/json" }
      }).then(res => res.text()).then(alert);
    }

    function buscarRegistro() {
      const celular = document.querySelector("[name='celular']").value;
      fetch(`${url}?celular=${celular}`)
        .then(res => res.json())
        .then(data => {
          if (data.error) return alert(data.error);
          for (let campo in data) {
            const input = document.querySelector(`[name="${campo}"]`);
            if (input) input.value = data[campo];
          }
        });
    }

    // Llenar el combo de tipificaciones desde Google Sheets
    fetch("https://opensheet.elk.sh/1yMB7CWaJ3TWNEudxR6o2BbaITGT3YykyW9s3rBbEvLk/TIPIFICACIONES")
      .then(res => res.json())
      .then(data => {
        const select = document.getElementById("tipificacion");
        data.forEach(row => {
          const opt = document.createElement("option");
          opt.value = row.tipi;
          opt.textContent = row.tipi;
          select.appendChild(opt);
        });
      });
  </script>
</body>
</html>
